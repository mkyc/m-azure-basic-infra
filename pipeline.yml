trigger:
  - develop
  - master
pr:
  - develop
  - master

pool:
  name: 'Azure Epiphany cluster - epiphany-build-agents-v2'

steps:
  - task: GoTool@0
    name: EnsureGo1_15_2
    inputs:
      version: '1.15.2'
  - task: Go@0
    name: GoTest
    inputs:
      command: 'test'
      arguments: '-v -timeout 30m'
      workingDirectory: '$(System.DefaultWorkingDirectory)'
    env:
      AZURE_CLIENT_ID: $CLIENTID
      AZURE_CLIENT_SECRET: $CLIENTSECRET
      AZURE_SUBSCRIPTION_ID: $SUBSCRIPTIONID
      AZURE_TENANT_ID: $TENANTID
      CGO_ENABLED: 0
